<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Serie</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;background:#f4f4f4;padding:20px}
.card{background:#fff;padding:10px;margin:10px;border-radius:8px}
.gray{filter:grayscale(100%)}
</style>
</head>
<body>

<a href="index.html">â¬… Home</a>

<h1 id="titoloSerie"></h1>

<input id="numero" placeholder="Numero">
<input type="date" id="data">
<select id="stato">
<option>Mint</option><option>NM</option><option>Good</option><option>Fair</option><option>Poor</option>
</select>
<select id="possesso">
<option value="celo">Ce l'ho</option>
<option value="manca">Manca</option>
</select>
<input id="img" placeholder="Immagine">
<button onclick="add()">Salva</button>

<div id="fumetti"></div>

<script>
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
const id=new URLSearchParams(location.search).get("id");

async function load(){
  const s=await db.collection("serie").doc(id).get();
  titoloSerie.textContent=s.data().titolo;

  const q=await db.collection("fumetti").where("serieId","==",id).get();
  fumetti.innerHTML="";
  q.forEach(d=>{
    const f=d.data();
    fumetti.innerHTML+=`
      <div class="card">
        <b>#${f.numero}</b> ${f.stato} (${f.possesso})
        <br>
        <img src="${f.immagine||''}" class="${f.possesso==='manca'?'gray':''}">
      </div>`;
  });
}

async function add(){
  await db.collection("fumetti").add({
    serieId:id,
    numero:numero.value,
    data:new Date(data.value),
    stato:stato.value,
    possesso:possesso.value,
    immagine:img.value
  });
  load();
}

load();
</script>
</body>
</html>
