<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>ComicZoo – Editing Serie</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body { font-family:Arial; background:#f4f6f8; padding:20px; }
.card { background:#fff; padding:15px; border-radius:8px; max-width:400px; margin:auto; }
input,button { width:100%; padding:8px; margin:5px 0; }
</style>
</head>
<body>

<a href="index.html">⬅ Torna alla vetrina</a>

<div class="card">
<h2>➕ Serie</h2>
<input id="titolo" placeholder="Titolo">
<input id="collana" placeholder="Collana">
<input id="codiceEditore" placeholder="Codice Editore">
<input id="genere" placeholder="Genere">
<input id="immagine" placeholder="Link immagine">
<button id="save">Salva</button>
</div>

<script>
// FIREBASE
const firebaseConfig={
  apiKey:"AIzaSyCMWWtqeymGjCxQiQbGcIEZUAEkhaUt-TI",
  authDomain:"comiczoo.firebaseapp.com",
  projectId:"comiczoo"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(), db=firebase.firestore();

// ID serie
const params=new URLSearchParams(window.location.search);
const serieId=params.get("id");

auth.onAuthStateChanged(async user=>{
  if(!user) location.href="index.html";

  if(serieId){
    const doc=await db.collection("serie").doc(serieId).get();
    if(!doc.exists) return alert("Serie non trovata");

    const s=doc.data();
    document.getElementById("titolo").value=s.titolo;
    document.getElementById("collana").value=s.collana||"";
    document.getElementById("codiceEditore").value=s.codiceEditore;
    document.getElementById("genere").value=s.genere||"";
    document.getElementById("immagine").value=s.immagine||"";

    document.querySelector("h2").textContent="✏️ Modifica serie";
    document.getElementById("save").textContent="Aggiorna";
  }
});

// SALVA / AGGIORNA
document.getElementById("save").onclick=async()=>{
  if(!auth.currentUser) return alert("Non loggato");

  const data={
    uid:auth.currentUser.uid,
    titolo:document.getElementById("titolo").value,
    collana:document.getElementById("collana").value,
    codiceEditore:document.getElementById("codiceEditore").value,
    genere:document.getElementById("genere").value,
    immagine:document.getElementById("immagine").value
  };

  if(serieId){
    await db.collection("serie").doc(serieId).update(data);
  }else{
    data.createdAt=firebase.firestore.FieldValue.serverTimestamp();
    await db.collection("serie").add(data);
  }

  location.href="index.html";
};
</script>
</body>
</html>
