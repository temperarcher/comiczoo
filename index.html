<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>ComicZoo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;padding:20px;background:#f4f6f8}
.card{background:#fff;padding:15px;margin:10px 0;border-radius:8px}
input,select,button{width:100%;padding:8px;margin:4px 0}
</style>
</head>
<body>

<h1>ðŸ“š ComicZoo</h1>

<!-- LOGIN -->
<div id="auth" class="card">
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<button onclick="register()">Registrati</button>
</div>

<!-- APP -->
<div id="app" style="display:none">

<button onclick="logout()">Logout</button>

<div class="card">
<h3>âž• Nuovo fumetto</h3>
<input id="titolo" placeholder="Titolo">
<input id="serie" placeholder="Serie">
<input id="editore" placeholder="Casa editrice">
<input id="codice" placeholder="Codice editore">

<input id="giorno" placeholder="Giorno">
<input id="mese" placeholder="Mese">
<input id="anno" placeholder="Anno">

<select id="possesso" onchange="toggleStato()">
<option>In mio possesso</option>
<option>Manca</option>
</select>

<select id="stato">
<option>Mint</option>
<option>Near Mint</option>
<option>Good</option>
<option>Fair</option>
<option>Discreto</option>
</select>

<button onclick="salva()">Salva fumetto</button>
</div>

<div class="card">
<h3>ðŸ“– Collezione</h3>
<div id="lista"></div>
</div>

</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyCMWWtqeymGjCxQiQbGcIEZUAEkhaUt-TI",
  authDomain: "comiczoo.firebaseapp.com",
  projectId: "comiczoo"
});
const auth=firebase.auth();
const db=firebase.firestore();

/* AUTH */
function login(){
  auth.signInWithEmailAndPassword(email.value,password.value)
}
function register(){
  auth.createUserWithEmailAndPassword(email.value,password.value)
}
function logout(){auth.signOut()}

auth.onAuthStateChanged(u=>{
  authDiv.style.display=u?"none":"block";
  app.style.display=u?"block":"none";
  if(u) load();
});

/* FORM */
function toggleStato(){
  stato.disabled = possesso.value==="Manca";
}

/* SALVA */
async function salva(){
  const d=new Date(anno.value, mese.value-1, giorno.value);
  await db.collection("fumetti").add({
    uid:auth.currentUser.uid,
    titolo:titolo.value,
    serie:serie.value,
    editore:editore.value,
    codice:codice.value,
    data:d,
    possesso:possesso.value,
    stato:possesso.value==="In mio possesso"?stato.value:null
  });
  load();
}

/* LOAD */
async function load(){
  lista.innerHTML="";
  const snap=await db.collection("fumetti")
    .where("uid","==",auth.currentUser.uid)
    .get();

  snap.forEach(d=>{
    const f=d.data();
    lista.innerHTML+=`
      <div class="card">
        <b>${f.titolo}</b><br>
        ${f.serie} â€“ ${f.editore}<br>
        ${f.possesso} ${f.stato||""}
      </div>`;
  });
}
</script>

</body>
</html>
