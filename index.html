<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>ComicZoo</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body { font-family: Arial; background:#f4f6f8; padding:20px; }
.card { background:#fff; padding:15px; margin-bottom:10px; border-radius:8px; }
button,input,select { width:100%; padding:8px; margin:5px 0; }

.stelle-gold { color: gold; }
.stelle-gray { color: #999; }
.stelle-red { color: red; }

.grayscale { filter: grayscale(100%); }
</style>
</head>

<body>

<h1>ComicZoo</h1>

<div id="auth" class="card">
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button id="login">Login</button>
</div>

<div id="app" style="display:none">

<div class="card">
  <input id="titolo" placeholder="Titolo">
  <select id="possesso">
    <option value="Celo">Celo</option>
    <option value="Manca">Manca</option>
  </select>
  <select id="stato">
    <option value="Mint">Mint</option>
    <option value="Near Mint">Near Mint</option>
    <option value="Good">Good</option>
    <option value="Fair">Fair</option>
    <option value="Discreto">Discreto</option>
  </select>
  <button id="save">Salva</button>
</div>

<div id="lista"></div>

</div>

<script>
// FIREBASE
firebase.initializeApp({
  apiKey: "AIzaSyCMWWtqeymGjCxQiQbGcIEZUAEkhaUt-TI",
  authDomain: "comiczoo.firebaseapp.com",
  projectId: "comiczoo"
});

const auth = firebase.auth();
const db = firebase.firestore();

// AUTH
login.onclick = () => {
  auth.signInWithEmailAndPassword(email.value, password.value);
};

auth.onAuthStateChanged(user => {
  auth.style.display = user ? "none" : "block";
  app.style.display = user ? "block" : "none";
  if (user) load();
});

// STELLE COLORATE (★)
function stelle(stato) {
  if (!stato) return "";
  const map = {
    "Mint": {n:5,c:"stelle-gold"},
    "Near Mint": {n:4,c:"stelle-gray"},
    "Good": {n:3,c:"stelle-gray"},
    "Fair": {n:2,c:"stelle-red"},
    "Discreto": {n:1,c:"stelle-red"}
  };
  const s = map[stato];
  return `<span class="${s.c}">${"★".repeat(s.n)}</span>`;
}

// SALVA
save.onclick = async () => {
  await db.collection("fumetti").add({
    uid: auth.currentUser.uid,
    titolo: titolo.value,
    possesso: possesso.value,
    stato: possesso.value === "Celo" ? stato.value : null
  });
  load();
};

// LOAD
function load() {
  lista.innerHTML = "";
  db.collection("fumetti")
    .where("uid","==",auth.currentUser.uid)
    .get()
    .then(snap => {
      snap.forEach(doc => {
        const f = doc.data();
        lista.innerHTML += `
          <div class="card">
            <b>${f.titolo}</b><br>
            ${f.possesso}<br>
            Stato: ${stelle(f.stato)}
          </div>
        `;
      });
    });
}
</script>

</body>
</html>
