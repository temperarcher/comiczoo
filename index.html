<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>ComicZoo</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;background:#f4f4f4;padding:20px}
.card{background:#fff;padding:15px;margin:10px;border-radius:8px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,200px);gap:15px}
img{width:100%;border-radius:6px}
</style>
</head>
<body>

<h1>üìö ComicZoo</h1>

<div id="auth">
  <input id="email" placeholder="email">
  <input id="password" type="password" placeholder="password">
  <button onclick="login()">Login</button>
  <button onclick="register()">Registrati</button>
</div>

<div id="app" style="display:none">

<a href="editing.html">‚ûï Editing</a>
<button onclick="logout()">Logout</button>

<h2>üîç Ricerca serie</h2>
<input id="search" placeholder="titolo serie" oninput="loadSerie()">

<select id="filterCodice" onchange="loadSerie()">
  <option value="">Tutti i codici editore</option>
</select>

<div id="serie" class="grid"></div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCMWWtqeymGjCxQiQbGcIEZUAEkhaUt-TI",
  authDomain: "comiczoo.firebaseapp.com",
  projectId: "comiczoo"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

auth.onAuthStateChanged(u=>{
  auth.style.display = u ? "none":"block";
  app.style.display = u ? "block":"none";
  if(u){
    loadCodici();
    loadSerie();
  }
});

function login(){
  auth.signInWithEmailAndPassword(email.value,password.value);
}
function register(){
  auth.createUserWithEmailAndPassword(email.value,password.value);
}
function logout(){ auth.signOut(); }

async function loadCodici(){
  filterCodice.innerHTML=`<option value="">Tutti</option>`;
  const snap = await db.collection("codiciEditore").get();
  snap.forEach(d=>{
    filterCodice.innerHTML+=`<option>${d.id}</option>`;
  });
}

async function loadSerie(){
  const q = await db.collection("serie").get();
  const s = search.value.toLowerCase();
  const c = filterCodice.value;

  serie.innerHTML="";
  q.forEach(d=>{
    const x=d.data();
    if(s && !x.titolo.toLowerCase().includes(s)) return;
    if(c && x.codiceEditore!==c) return;

    serie.innerHTML+=`
      <div class="card">
        <img src="${x.immagine||''}">
        <h3>${x.titolo}</h3>
        <a href="serie.html?id=${d.id}">Apri</a>
        |
        <a href="editing.html?serie=${d.id}">Edit</a>
      </div>`;
  });
}
</script>
</body>
</html>
