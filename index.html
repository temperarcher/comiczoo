<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>ComicZoo</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;background:#f4f4f4;padding:20px}
.card{background:#fff;padding:10px;border-radius:8px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,200px);gap:15px}
img{width:100%;border-radius:6px}
</style>
</head>
<body>

<h1>üìö ComicZoo</h1>

<div id="auth">
  <input id="email" placeholder="email">
  <input id="password" type="password" placeholder="password">
  <button onclick="login()">Login</button>
  <button onclick="register()">Registrati</button>
</div>

<div id="app" style="display:none">
  <a href="editing.html">‚ûï Editing</a>
  <button onclick="logout()">Logout</button>

  <h2>üîç Ricerca serie</h2>
  <input id="search" placeholder="Titolo serie" oninput="loadSerie()">

  <select id="filterCodice" onchange="loadSerie()">
    <option value="">Tutti i codici editore</option>
  </select>

  <div id="serie" class="grid"></div>
</div>

<script>
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(), db=firebase.firestore();

auth.onAuthStateChanged(u=>{
  authDiv.style.display=u?"none":"block";
  app.style.display=u?"block":"none";
  if(u){loadCodici();loadSerie();}
});

function login(){auth.signInWithEmailAndPassword(email.value,password.value);}
function register(){auth.createUserWithEmailAndPassword(email.value,password.value);}
function logout(){auth.signOut();}

async function loadCodici(){
  filterCodice.innerHTML=`<option value="">Tutti</option>`;
  const s=await db.collection("codiciEditore").get();
  s.forEach(d=>filterCodice.innerHTML+=`<option>${d.id}</option>`);
}

async function loadSerie(){
  const q=await db.collection("serie").get();
  const t=search.value.toLowerCase();
  const c=filterCodice.value;
  serie.innerHTML="";
  q.forEach(d=>{
    const x=d.data();
    if(t && !x.titolo.toLowerCase().includes(t)) return;
    if(c && x.codiceEditore!==c) return;
    serie.innerHTML+=`
      <div class="card">
        <img src="${x.immagine||''}">
        <b>${x.titolo}</b><br>
        <a href="serie.html?id=${d.id}">Apri</a> |
        <a href="editing.html?serie=${d.id}">Edit</a>
      </div>`;
  });
}
</script>
</body>
</html>
