<div class="mt-4">
                        <label class="text-[10px] font-bold text-yellow-500 uppercase tracking-widest block mb-2">Storie Incluse</label>
                        <div id="issue-stories-list" class="space-y-2 max-h-48 overflow-y-auto custom-scrollbar pr-2">
                            </div>
                    </div>

<script>
        // ... (altre funzioni costanti) ...

        // FUNZIONE RECUPERO STORIE (V7.0 CORRETTA)
        async function loadIssueStories(issueId) {
            const list = document.getElementById('issue-stories-list');
            list.innerHTML = `<p class="text-[10px] text-slate-500 italic uppercase">Caricamento storie...</p>`;
            
            // Query corretta: posizione da storie_in_issue e nome da storie (tramite storia_id)
            const { data: stories, error } = await window.supabaseClient
                .from('storie_in_issue')
                .select(`
                    posizione,
                    storie (
                        nome
                    )
                `)
                .eq('issue_id', issueId)
                .order('posizione', { ascending: true });

            if (error) {
                console.error("Errore recupero storie:", error);
                list.innerHTML = `<p class="text-[10px] text-red-400 italic uppercase">Errore caricamento</p>`;
                return;
            }

            if (!stories || stories.length === 0) {
                list.innerHTML = `<p class="text-[10px] text-slate-500 italic uppercase">Nessuna storia associata</p>`;
                return;
            }

            list.innerHTML = stories.map(s => `
                <div class="flex items-center gap-2 bg-slate-900/50 p-2 rounded border border-slate-700/50 group hover:border-yellow-500/50 transition-all">
                    <span class="text-[10px] font-black text-yellow-500 bg-slate-800 w-5 h-5 flex items-center justify-center rounded shrink-0">${s.posizione || '-'}</span>
                    <span class="text-[11px] font-bold text-slate-200 truncate uppercase tracking-tight">${s.storie?.nome || 'Senza titolo'}</span>
                </div>
            `).join('');
        }

        async function openEditModal(comicData) {
            const comic = JSON.parse(decodeURIComponent(comicData));
            
            // Reset e popolamento campi standard (esattamente come 6.2)
            document.getElementById('modal-title').innerText = "Modifica Albo";
            document.getElementById('edit-id').value = comic.id;
            document.getElementById('edit-nome').value = comic.nome || "";
            document.getElementById('edit-numero').value = comic.numero || "";
            document.getElementById('edit-condizione').value = comic.condizione || "";
            document.getElementById('edit-valore').value = comic.valore || "";
            document.getElementById('edit-possesso').value = comic.possesso || "celo";
            document.getElementById('edit-data_pubblicazione').value = comic.data_pubblicazione || "";
            document.getElementById('edit-immagine_url').value = comic.immagine_url || "";
            document.getElementById('edit-preview').src = comic.immagine_url || placeholderImg;
            
            // CHIAMATA ALLA NUOVA FUNZIONE STORIE
            loadIssueStories(comic.id);

            // ... (resto della funzione openEditModal come nella 6.2) ...
            await loadSerieSelect(comic.serie_id);
            await loadSelectOptions('editore', 'edit-editore_id', comic.editore_id);
            await loadSelectOptions('testata', 'edit-testata_id', comic.testata_id);
            await loadSelectOptions('annata', 'edit-annata_id', comic.annata_id);
            await loadSelectOptions('tipo_pubblicazione', 'edit-tipo_pubblicazione_id', comic.tipo_pubblicazione_id);
            await loadSupplementoSelect(comic.supplemento_id);
            await handleSerieChange(comic.serie_id);
            document.getElementById('edit-modal').classList.remove('hidden');
        }

        // ... (tutte le altre funzioni di salvataggio e gestione della 6.2) ...
    </script>